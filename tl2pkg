#!/usr/pkg/bin/ruby19
# -*- ruby -*-

def usage
  puts 'Usage: tl2pkg <command> [args]'
end

def fetch_tlpdb(filename)
  require 'net/http'
  require 'xz'

  res = Net::HTTP.start('dante.ctan.org') {|http|
    http.get('/get/systems/texlive/tlnet/tlpkg/texlive.tlpdb.xz')
  }
  tlpdb = XZ.decompress(res.body)
  open(filename, 'w') do |file|
    file.write(tlpdb)
  end
end

if ARGV.size < 1 then
  usage
  exit 1
end

if ARGV[0] == 'dbfetch' then
  print 'Downloading the TeX Live package database ... '
  $stdout.flush
  fetch_tlpdb('texlive.tlpdb')
  print "done.\n"
else
  print "Unknown command: #{ARGV[0]}\n"
end
